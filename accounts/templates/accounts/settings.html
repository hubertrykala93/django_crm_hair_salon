{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<section class="user-authentication">
    <div class="container">
        <div class="profile">
            <div class="profile-header">
                <img class="profile-image" src="{{ request.user.profile.basic_information.profile_image.image.url }}" alt="{{ request.user.profile.basic_information.profile_image.alt }}">
                <div class="profile-text-container">
                    <h1 class="profile-title">{% if request.user.profile.basic_information.firstname and request.user.profile.basic_information.lastname %}{{ request.user.profile.basic_information.firstname }} {{ request.user.profile.basic_information.lastname }}{% else %}{{ request.user.username }}{% endif %}</h1>
                    <p class="profile-email">{{ request.user.email }}</p>
                </div>
            </div>
            <div class="menu">
                <a href="{% url 'settings' %}" class="menu-link {% if not request.GET %}active{% endif %}"><i class="fa-solid fa-circle-info"></i>General</a>
                <a href="?change-password" class="menu-link {% if 'change-password' in request.GET %}active{% endif %}"><i class="fa-solid fa-gear"></i>Change Password</a>
                <a href="?basic-information" class="menu-link {% if 'basic-information' in request.GET %}active{% endif %}"><i class="fa-solid fa-user"></i>Basic Information</a>
                <a href="?contact-information" class="menu-link {% if 'contact-information' in request.GET %}active{% endif %}"><i class="fa-solid fa-phone"></i>Contact Information</a>
                <a href="?payment-information" class="menu-link {% if 'payment-information' in request.GET %}active{% endif %}"><i class="fa-solid fa-credit-card"></i>Payment Information</a>
                <a href="?benefits" class="menu-link {% if 'benefits' in request.GET %}active{% endif %}"><i class="fa-solid fa-credit-card"></i>Benefits</a>
                <a href="?invoices" class="menu-link {% if 'invoices' in request.GET %}active{% endif %}"><i class="fa-solid fa-file-invoice"></i>Invoices</a>
            </div>
        </div>

        <div class="user-info">

            {% if not request.GET %}
            <div class="info-header">
                <h1 class="info-title">Information</h1>
            </div>

            <div class="info-row">
                <label class="info-label">Username:</label>
                <p class="info-email">{{ request.user.username }}</p>
            </div>

            <div class="info-row">
                <label class="info-label">Email:</label>
                <p class="info-email">{{ request.user.email }}</p>
            </div>

            {% if request.user.profile.employment_information.job_position.name %}
            <div class="info-row">
                <label class="info-label">Position:</label>
                <p class="info-email">{{ request.user.profile.employment_information.job_position.name }}</p>
            </div>
            {% endif %}

            {% if request.user.profile.employment_information.employment_status.name %}
            <div class="info-row">
                <label class="info-label">Status:</label>
                <p class="info-email">{{ request.user.profile.employment_information.employment_status.name }}</p>
            </div>
            {% endif %}

            {% if request.user.profile.employment_information.contract.name %}
            <div class="info-row">
                <label class="info-label">Contract:</label>
                <p class="info-email">{{ request.user.profile.employment_information.contract.name }}</p>
            </div>
            {% endif %}

            {% if request.user.profile.employment_information.contract.salary %}
            <div class="info-row">
                <label class="info-label">Salary:</label>
                <p class="info-email">{{ request.user.profile.employment_information.contract.salary|floatformat:1 }}{% if request.user.profile.employment_information.contract.currency %} {{ request.user.profile.employment_information.contract.currency.name }}{% endif %}</p>
            </div>
            {% endif %}

            {% if request.user.profile.employment_information.contract.start_date %}
            <div class="info-row">
                <label class="info-label">Start Date:</label>
                <p class="info-email">{{ request.user.profile.employment_information.contract.start_date|date:'Y-m-d' }}</p>
            </div>
            {% endif %}

            {% if request.user.profile.employment_information.contract.end_date %}
            <div class="info-row">
                <label class="info-label">End Date:</label>
                <p class="info-email">{{ request.user.profile.employment_information.contract.end_date|date:'Y-m-d' }}</p>
            </div>

            <div class="info-row">
                <label class="info-label">Time Remaining:</label>
                <p class="info-email">{{ time_remaining.days }}</p>
            </div>
            {% endif %}

            {% elif 'change-password' in request.GET %}
            <form method="post">
                {% csrf_token %}

                <div class="info-header">
                    <h1 class="info-title">Change Password</h1>
                </div>
                <div class="form-row">
                    <label for="password" class="info-label">New Password</label>
                    <input type="password" id="password" name="password" placeholder="New Password">
                    {% if update_password_form.password.errors %}
                    {% for error in update_password_form.password.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <div class="form-row">
                    <label for="repassword" class="info-label">Confirm Password</label>
                    <input type="password" id="repassword" name="repassword" placeholder="Confirm Password">
                    {% if update_password_form.repassword.errors %}
                    {% for error in update_password_form.repassword.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <button class="btn form-submit-btn" type="submit" name="change-password">Save</button>
            </form>
            {% elif 'basic-information' in request.GET %}
            <form method="post">
                {% csrf_token %}

                <div class="info-header">
                    <h1 class="info-title">Basic Information</h1>
                </div>
                <div class="form-row">
                    <label for="firstname" class="info-label">Firstname</label>
                    <input type="text" id="firstname" name="firstname" value="{% if request.user.profile.basic_information.firstname %}{{ request.user.profile.basic_information.firstname }}{% endif %}" placeholder="Firstname">
                    {% if update_basic_information_form.firstname.errors %}
                    {% for error in update_basic_information_form.firstname.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <div class="form-row">
                    <label for="lastname" class="info-label">Lastname</label>
                    <input type="text" id="lastname" name="lastname" value="{% if request.user.profile.basic_information.lastname %}{{ request.user.profile.basic_information.lastname }}{% endif %}" placeholder="Lastname">
                    {% if update_basic_information_form.lastname.errors %}
                    {% for error in update_basic_information_form.lastname.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <div class="form-row">
                    <label for="date_of_birth" class="info-label">Date of Birth</label>
                    <input type="text" id="date_of_birth" name="date_of_birth" value="{% if request.user.profile.basic_information.date_of_birth %}{{ request.user.profile.basic_information.date_of_birth|date:'Y-m-d' }}{% endif %}" placeholder="Date of Birth">
                    {% if update_basic_information_form.date_of_birth.errors %}
                    {% for error in update_basic_information_form.date_of_birth.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <div class="form-row">
                    <label for="biography">Biography</label>
                    <textarea id="biography" name="biography" placeholder="Biography">{% if request.user.profile.basic_information.biography %}{{ request.user.profile.basic_information.biography }}{% endif %}</textarea>
                    {% if update_basic_information_form.biography.errors %}
                    {% for error in update_basic_information_form.biography.errors %}
                    <span class="form-error">{{ error }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <button class="btn form-submit-btn" type="submit" name="basic-information">Save</button>
            </form>
            {% elif 'contact-information' in request.GET %}
            <form method="post">
                {% csrf_token %}

                <div class="info-header">
                    <h1 class="info-title">Contact Information</h1>
                </div>
                <div class="form-row">
                    <label for="phone_number" class="info-label">Phone Number</label>
                    <input type="text" id="phone_number" name="phone_number" value="{% if request.user.profile.contact_information.phone_number %}{{ request.user.profile.contact_information.phone_number }}{% endif %}" placeholder="Phone Number">
                </div>
                <div class="form-row">
                    <label for="country" class="info-label">Country</label>
                    <input type="text" id="country" name="country" value="{% if request.user.profile.contact_information.country %}{{ request.user.profile.contact_information.country }}{% endif %}" placeholder="Country">
                </div>
                <div class="form-row">
                    <label for="province" class="info-label">Province</label>
                    <input type="text" id="province" name="province" value="{% if request.user.profile.contact_information.province %}{{ request.user.profile.contact_information.province }}{% endif %}" placeholder="Province">
                </div>
                <div class="form-row">
                    <label for="city" class="info-label">City</label>
                    <input type="text" id="city" name="city" value="{% if request.user.profile.contact_information.city %}{{ request.user.profile.contact_information.city }}{% endif %}" placeholder="City">
                </div>
                <div class="form-row">
                    <label for="postal_code" class="info-label">Postal Code</label>
                    <input type="text" id="postal_code" name="postal_code" value="{% if request.user.profile.contact_information.postal_code %}{{ request.user.profile.contact_information.postal_code }}{% endif %}" placeholder="Postal Code">
                </div>
                <div class="form-row">
                    <label for="street" class="info-label">Street</label>
                    <input type="text" id="street" name="street" value="{% if request.user.profile.contact_information.street %}{{ request.user.profile.contact_information.street }}{% endif %}" placeholder="Street">
                </div>
                <div class="form-row">
                    <label for="house_number" class="info-label">House Number</label>
                    <input type="text" id="house_number" name="house_number" value="{% if request.user.profile.contact_information.house_number %}{{ request.user.profile.contact_information.house_number }}{% endif %}" placeholder="House Number">
                </div>
                <div class="form-row">
                    <label for="apartment_number" class="info-label">Apartment Number</label>
                    <input type="text" id="apartment_number" name="apartment_number" value="{% if request.user.profile.contact_information.apartment_number %}{{ request.user.profile.contact_information.apartment_number }}{% endif %}" placeholder="Apartment Number">
                </div>
                <button class="btn form-submit-btn" type="submit">Save</button>
            </form>
            {% elif 'payment-information' in request.GET %}
            <form method="post">
                {% csrf_token %}

                <div class="info-header">
                    <h1 class="info-title">Payment Information</h1>
                </div>
                <div class="form-row">
                    <label for="iban" class="info-label">IBAN</label>
                    <input type="text" id="iban" name="iban" value="{% if request.user.profile.payment_information.iban %}{{ request.user.profile.payment_information.iban }}{% endif %}" placeholder="IBAN">
                </div>
                <div class="form-row">
                    <label for="account_number" class="info-label">Account Number</label>
                    <input type="text" id="account_number" name="account_number" value="{% if request.user.profile.payment_information.account_number %}{{ request.user.profile.payment_information.account_number }}{% endif %}" placeholder="Account Number">
                </div>
                <div class="form-row">
                    <label for="payment_frequency" class="info-label">Payment Frequency</label>
                    <select class="form-select" id="payment_frequency" name="payment_frequency">Select Payment Frequency
                        {% for payment_frequency in payment_frequencies %}
                        <option value="{{ payment_frequency }}" {% if payment_frequency == request.GET.payment_frequency %}selected{% endif %}>{{ payment_frequency }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button class="btn form-submit-btn" type="submit">Save</button>
            </form>
            {% elif 'benefits' in request.GET %}
            <div class="info-header">
                <h1 class="info-title">Benefits</h1>
            </div>
            <div class="info-row">
                <label class="info-label">Username:</label>
                <p class="info-email">{{ request.user.username }}</p>
            </div>
            {% elif 'invoices' in request.GET %}
            <div class="info-header">
                <h1 class="info-title">Invoices</h1>
            </div>
            <div class="info-row">
                <label class="info-label">Username:</label>
                <p class="info-email">{{ request.user.username }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
